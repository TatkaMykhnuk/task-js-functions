<!doctype html>
<html lang="en">
<head>
    <title>javascript</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script type='text/javascript'>

var galleries = {
    gallery1: {
        images: [
            {
                "name": "cat",
                "path": "images/cat.png",
                "description": "The best cat ever",
                "date": "2014-07-21T09:05:34.540Z",
                "modificationDatetime": "2014-07-21T09:07:47.683Z"
            },
            {
                "name": "dog",
                "description": "",
                "date": "2014-07-21T09:06:05.544Z",
                "modificationDatetime": "2014-07-21T09:07:47.683Z"
            },
            {
                "name": "giraffe",
                "path": "images/giraffe.png",
                "description": "",
                "date": "2014-07-21T09:07:24.187Z"
            },
            {
                "name": "dinosaur",
                "path": "images/dinosaur.png",
                "description": "",
                "date": "2014-07-21T09:07:47.683Z",
                "modificationDatetime": "2014-07-21T09:07:47.683Z"
            }
        ]
    },
    gallery2: {
        images: [
            {
                "name": "bird",
                "path": "images/cat.png",
                "description": "The best cat ever",
                "date": "2014-07-21T09:05:34.540Z",
                "modificationDatetime": "2014-07-21T09:07:47.683Z"
            },
            {
                "name": "pig",
                "description": "",
                "date": "2014-07-21T09:06:05.544Z"
            }
        ]
    }
};

var defaultImagesCollectionName = "images";

function addImage(imagesCollectionName, newImage){
    this[imagesCollectionName].push(newImage);
    var message = "Äîäàíî çîáðàæåííÿ";
    if(newImage.hasOwnProperty("name"))
        message = message + " \"" + newImage.name + "\"";
    else
        message = message + " \"nonamed\"";
    showInformation(message);
}

function changeKeysValue(imagesCollectionName, imageIndex, key, newValue){
    var targetImage = this[imagesCollectionName][imageIndex];
    targetImage[key] = newValue; 
    showInformation("Çíà÷åííÿ êëþ÷à \"" + key + "\" äëÿ çîáðàæåííÿ "+ imageIndex +" áóëà çì³íåíî íà çíà÷åííÿ \"" + newValue + "\"");
}

function removeImages(imagesCollectionName, startIndex, count){
    var imagesCollection = this[imagesCollectionName];
    var message = "Âèäàëåíî çîáðàæííÿ: ";
    for(var i=startIndex; i<imagesCollection.length; i++){
        if(i >= (startIndex+count)) break;
        message = message +  imagesCollection[i].name + ", ";
    }
    imagesCollection.splice(startIndex, count);
    showInformation(message);
}

function showGalleryImages(imagesCollectionName){
    for(var i=0; i<this[imagesCollectionName].length; i++){
        showImageInformation(this[imagesCollectionName][i]);
        showInformation("-----------------------");
    }
}

function showImageInformation(imageObject){
    for (var key in imageObject) {
            if (imageObject.hasOwnProperty(key))
                showInformation(key + ": " + imageObject[key]);
        }
}

function showInformation(message, isSpaceBefore){
    if(isSpaceBefore === true)
        console.log("");
    console.log(message);
}

function sortBy(imagesCollectionName, sortingFunction){
    this[imagesCollectionName].sort(sortingFunction);
}

function getFilteredArrayByParam(imagesCollectionName, param){
    var result = {images:[]};
    var gallery = this[imagesCollectionName];
    for(var i=0; i<gallery.length; i++){
        if (gallery[i].hasOwnProperty(param))
            result["images"].push(gallery[i]);
    }

    showInformation("Âñüîãî êàðòèíîê: " + gallery.length + " Ï³ñëÿ ô³ëüòðàö³¿: " + result[defaultImagesCollectionName].length);
    return result;
}

function serialize(memberfilter){
    return JSON.stringify(this, memberfilter, "\t");
}
        
function checkImagesDescription(){
    var galleryImages = this[defaultImagesCollectionName];
    for(var i=0; i<galleryImages.length; i++){
        if(galleryImages[i].description == "")
            showInformation("Çîáðàæåííÿ " + galleryImages[i]['name']+ " íå ìàº îïèñó");
    }
}

for(var g in galleries){
    showInformation("Ïðàöþºìî ç ãàëàðåºþ " + g, true);

    var gallery = galleries[g];

    //1. Äîäàòè, ðåäàãóâàòè, âèäàëèòè êàðòèíêó ãàëåðå¿.
    showInformation("Äîäàòè êàðòèíêó äî ãàëåðå¿.");
    var newImage={
        name:"horse",
        path:"images/horse.png",
        description:"The best horse ever",
        date:new Date().toISOString()
    };
    addImage.call(gallery, defaultImagesCollectionName, newImage);
//â³äîáðàæåííÿ ðåçóëüòàòó äîäàâàííÿ êàðòèíêè äî ãàëåðå¿
    showGalleryImages.call(gallery, defaultImagesCollectionName);

    showInformation("Ðåäàãóâàòè êàðòèíêó ãàëåðå¿.", true);
//ðåäàãóºìî ïåðøó êàðòèíêó â ãàëåðå¿ "gallery", çì³íþåìî ³ìÿ êàðòèíêè íà "kitten"
    changeKeysValue.call(gallery, defaultImagesCollectionName, 0, "name", "kitten");
//â³äîáðàæåííÿ ðåçóëüòàòó ðåäàãóâàííÿ êàðòèíêè ãàëåðå¿
    showGalleryImages.call(gallery, defaultImagesCollectionName);

    showInformation("Âèäàëèòè êàðòèíêó ãàëåðå¿.", true);
//âèäàëÿºìî êàðòèíêè ç ãàëåðå¿ "gallery", âèäàëÿåìî êàðòèíêè ïî÷èíàþ÷è ç ³íäåêñó 2 òà ê³ëüê³ñòþ 2 øò
    removeImages.call(gallery, defaultImagesCollectionName, 2, 2);
//â³äîáðàæåííÿ ðåçóëüòàòó âèäàëåííÿ êàðòèíîê ãàëåðå¿
    showGalleryImages.call(gallery, defaultImagesCollectionName);

//2. Íàïèñàòè ôóíêö³þ, ùî áóäå âèâîäèòè íà åêðàí ³íôîðìàö³þ ïðî ïåðåäàí³ êàðòèíêè ãàëåðå¿. Òà âèêîðèñòîâóâàòè ¿¿ äëÿ âèâåäåííÿ ðåçóëüòàòó ðîáîòè âñ³õ ôóíêö³é ãàëåðå¿.
    showInformation("Â³äîáðàæåííÿ âñ³õ êàðòèíîê ãàëåðå¿", true);
    showGalleryImages.call(gallery, defaultImagesCollectionName);

//3. Â³äñîðòóâàòè êàðòèíêè ïî çàçíà÷åíîìó ïîëþ (ïîëå ïåðåäàâàòè àðãóìåíòîì ó ôóíêö³þ).
    showInformation("Ñîðòóâàííÿ êàðòèíîê ãàëåðå¿ ïî ³ìåí³ â ïîðÿäêó ñïàäàííÿ", true);
//ñîðòóºìî êàðòèíêè ãàëåðå¿ "gallery" ïî ïîëþ "name"
    var key = "name";
    var sortingFunction = function(obj1, obj2){
        if (!obj1.hasOwnProperty(key) || !obj2.hasOwnProperty(key))
            return -1;
        if (obj1[key] < obj2[key]) return -1;
        if (obj1[key] > obj2[key]) return 1;
        return 0;
    };
    sortBy.call(gallery, defaultImagesCollectionName, sortingFunction);
//â³äîáðàæåííÿ ðåçóëüòàòó ñîðòóâàííÿ êàðòèíîê ãàëåðå¿
    showGalleryImages.call(gallery, defaultImagesCollectionName);

//4. Â³äô³ëüòðóâàòè êàðòèíêè ïî ïåðåäàíîìó ïîëþ.
    var filteringKey = "modificationDatetime";
    showInformation("Ô³ëüòðóâàííÿ êàðòèíîê ãàëåðå¿, çàëèøàþòüñÿ êàðòèíêè ÿê³ ìàþòü ïîëå \"" + filteringKey + "\" ", true);
//â³äô³ëüòðîâóºìî ò³ëüêè ò³ êàðòèíêè â ãàëåðå¿ "gallery" ÿê³ ìàþòü ïîëå "modificationDatetime"
    var filteredGallery = getFilteredArrayByParam.call(gallery, defaultImagesCollectionName, filteringKey);
//â³äîáðàæåííÿ ðåçóëüòàòó ô³ëüòðóâàííÿ êàðòèíîê ãàëåðå¿
    showGalleryImages.call(filteredGallery, defaultImagesCollectionName);

//5. Ñåð³àë³çâàòè ãàëåðåþ â ôîðìàò JSON. Äîäàòè ìîæëèâ³ñòü ñåð³àë³çóâàòè ïîëÿ ïî äåÿê³é óìîâ³. Íàïðèêëàä, ëèøå ³ìåíà êàðòèíîê, àáî ëèøå êàðòèíêè, ùî ìàþòü øëÿõ äî ôàéëà.
    showInformation("Ñåð³àë³çàö³ÿ âñ³º¿ ãàëåðå¿ â ôîðìàò JSON", true);
    var result = serialize.call(gallery);
    showInformation(result);

    showInformation("Ñåð³àë³çàö³ÿ êàðòèíîê ãàëåðå¿ â ÿêèõ º øëÿõ äî ôàéëó êàðòèíêè â ôîðìàò JSON");

    var filteredGalleryByPath = getFilteredArrayByParam.call(gallery, defaultImagesCollectionName, 'path');

    showInformation(serialize.call(filteredGalleryByPath));

    showInformation("Ñåð³àë³çàö³ÿ ëèøå íàçâ òà îïèñó âñ³õ êàðòèíîê ãàëåðå¿ â ôîðìàò JSON", true);
    var memberFilter = ["images", "name", "description"];
    showInformation(serialize.call(gallery, memberFilter));

//6. Íàïèñàòè ôóíêö³þ, ùî áóäå ïåðåâ³ðÿòè, ÷è âñ³ êàðòèíêè ìàþòü îïèñ.
    showInformation("Ïåðåâ³ðêà êàðòèíîê, ÷è âñ³ ìàþòü îïèñ", true);
    checkImagesDescription.call(gallery);
}

</script>
</head>
<body>

</body>
</html>